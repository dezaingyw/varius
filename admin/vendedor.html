<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vendedor ‚Äî Pedidos</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <link rel="stylesheet" href="assets/css/order-management.css">
  <link rel="stylesheet" href="../assets/css/presence.css">
</head>

<body>
  <input id="nav-toggle" type="checkbox" class="nav-toggle" aria-hidden="true">

  <header class="topbar">
    <div class="top-left">
      <label for="nav-toggle" class="hamburger" aria-hidden="true">
        <span class="hamburger-box"><span class="hamburger-inner"></span></span>
      </label>
      <a class="brand" href="./" aria-label="Dashboard">
        <img src="assets/img/logo.png" alt="Varius" width="14%">
        <span class="brand-text">VARIUS</span>
      </a>
    </div>

    <div class="top-search">
      <!-- input eliminado intencionalmente -->
      <div id="presence-pill" class="presence-pill offline" role="status" aria-live="polite">
        <span class="dot"></span>
        <span class="label">Desconectado</span>
      </div>
    </div>
  </header>

  <div id="app-sidebar"></div>

  <main class="main">

    <section class="kpis" aria-label="Indicadores r√°pidos">
      <!-- Pedidos hoy -->
      <article class="card kpi-card kpi-modern kpi-variant-info" id="kpi-card-orders" data-kpi="orders-today"
        tabindex="0" role="button" aria-pressed="false">
        <div class="kpi-top">
          <div class="kpi-avatar" aria-hidden="true">üì¶</div>
          <div>
            <div class="kpi-title">Pedidos hoy (tuyos)</div>
            <div class="kpi-sub">Comparado con ayer</div>
          </div>
        </div>

        <div class="kpi-divider" role="separator"></div>

        <div>
          <div class="kpi-amount kpi-value" id="kpi-orders-today">‚Äî</div>
        </div>

        <div class="kpi-bottom">
          <div class="kpi-meta muted">√öltima actualizaci√≥n</div>
          <button class="kpi-action" aria-label="Abrir detalles">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-right-fill" viewBox="0 0 16 16">
              <path
                d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
            </svg>
          </button>
        </div>
      </article>

      <!-- Ventas hoy -->
      <article class="card kpi-card kpi-modern kpi-variant-info" id="kpi-card-sales" data-kpi="sales-today" tabindex="0"
        role="button" aria-pressed="false">
        <div class="kpi-top">
          <div class="kpi-avatar" aria-hidden="true">üí≤</div>
          <div>
            <div class="kpi-title">Ventas hoy (tuyas)</div>
            <div class="kpi-sub">Total diario</div>
          </div>
        </div>

        <div class="kpi-divider"></div>

        <div>
          <div class="kpi-amount">$<span id="kpi-sales">‚Äî</span></div>
        </div>

        <div class="kpi-bottom">
          <div class="kpi-meta muted">Ingresos verificados</div>
          <button class="kpi-action" aria-label="Ver ventas">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-right-fill" viewBox="0 0 16 16">
              <path
                d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
            </svg>
          </button>
        </div>
      </article>

      <!-- Pedidos asignados -->
      <article class="card kpi-card kpi-modern kpi-variant-info" id="kpi-card-assigned" data-kpi="assigned" tabindex="0"
        role="button" aria-pressed="false">
        <div class="kpi-top">
          <div class="kpi-avatar" aria-hidden="true">üè∑Ô∏è</div>
          <div>
            <div class="kpi-title">Pedidos asignados</div>
            <div class="kpi-sub">En curso</div>
          </div>
        </div>

        <div class="kpi-divider"></div>

        <div>
          <div class="kpi-amount" id="kpi-assigned">‚Äî</div>
        </div>

        <div class="kpi-bottom">
          <div class="kpi-meta muted">En proceso</div>
          <button class="kpi-action" aria-label="Ver asignados">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-caret-right-fill" viewBox="0 0 16 16">
              <path
                d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
            </svg>
          </button>
        </div>
      </article>
    </section>

    <section class="table-wrap card quick-actions-card" aria-label="Acciones r√°pidas">
      <div class="table-header" style="padding: 18px 12px;">
        <h3>Acciones R√°pidas</h3>
      </div>
      <div class="quick-actions" style="padding: 12px;">
        <button class="action-btn" onclick="window.location.href='product.html'">
          <span class="action-icon">üè¨</span>
          <span>Inventario</span>
        </button>
        <button class="action-btn" onclick="window.location.href='orders.html'">
          <span class="action-icon">üìã</span>
          <span>Pedidos</span>
        </button>
      </div>
    </section>

    <!-- Filters -->
    <section class="card filters-card" aria-label="Filtros" style="margin-top: 16px;">
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items: flex-end;">
        <div class="filter-field" style="min-width:220px;">
          <label for="filter-status">Estado del Pedido</label>
          <select id="filter-status">
            <option value="">Todos</option>
            <option value="pendiente">Pendiente</option>
            <option value="asignado">Asignado</option>
            <option value="en camino">En camino</option>
            <option value="entregado">Entregado</option>
            <option value="cancelado">Cancelado</option>
            <option value="suspendido">Suspendido</option>
          </select>
        </div>

        <div class="filter-field" style="min-width:220px;">
          <label for="filter-date">Fecha</label>
          <input id="filter-date" type="date" />
        </div>

        <div class="filter-field" style="flex:1;min-width:200px;">
          <label for="filter-client">Buscar cliente</label>
          <input id="filter-client" type="search" placeholder="Buscar cliente..." />
        </div>

        <div style="display:flex;gap:8px;align-items:end;">
          <button id="btnFilter" class="btn-apply">Buscar</button>
          <button id="btnClear" class="icon-btn">Limpiar</button>
        </div>
      </div>
    </section>

    <section class="table-wrap card" style="display:flex;gap:16px;margin-top:16px;">
      <div style="flex:1;min-width:0;">
        <div class="table-header">
          <h3>Lista de Pedidos</h3>
        </div>

        <div class="table-scroll" id="orders-area">
          <!-- Desktop / tablet table -->
          <table id="ordersTable" class="orders-table" aria-label="Tabla de pedidos">
            <thead>
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha</th>
                <th>Total</th>
                <th>Vendedor</th>
                <th>Motorizado</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="ordersTbody">
              <!-- Rows injected by JS -->
            </tbody>
          </table>

          <!-- Mobile: cards -->
          <div id="ordersCards" aria-live="polite"></div>
        </div>
      </div>

      <!-- Chat removed per request -->
    </section>
  </main>

  <!-- View Modal -->
  <div id="order-view-modal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-content modal-lg" role="document">
      <div class="modal-header">
        <h2 id="view-order-title">Detalle del Pedido</h2>
        <button class="close-btn" id="view-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body" id="view-order-body">
        <!-- Injected -->
      </div>
      <div class="modal-footer" style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
        <button id="view-history" class="btn-small btn-history" title="Historial del cliente">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history"
            viewBox="0 0 16 16">
            <path
              d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022zm2.004.45a7 7 0 0 0-.985-.299l.219-.976q.576.129 1.126.342zm1.37.71a7 7 0 0 0-.439-.27l.493-.87a8 8 0 0 1 .979.654l-.615.789a7 7 0 0 0-.418-.302zm1.834 1.79a7 7 0 0 0-.653-.796l.724-.69q.406.429.747.91zm.744 1.352a7 7 0 0 0-.214-.468l.893-.45a8 8 0 0 1 .45 1.088l-.95.313a7 7 0 0 0-.179-.483m.53 2.507a7 7 0 0 0-.1-1.025l.985-.17q.1.58.116 1.17zm-.131 1.538q.05-.254.081-.51l.993.123a8 8 0 0 1-.23 1.155l-.964-.267q.069-.247.12-.501m-.952 2.379q.276-.436.486-.908l.914.405q-.24.54-.555 1.038zm-.964 1.205q.183-.183.35-.378l.758.653a8 8 0 0 1-.401.432z" />
            <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0z" />
            <path
              d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5" />
          </svg>
        </button>
        <button id="view-close-bottom" class="btn-small btn-suspender">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="order-edit-modal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h2 id="edit-order-title">Editar Pedido</h2>
        <button class="close-btn" id="edit-close" aria-label="Cerrar">&times;</button>
      </div>
      <div class="modal-body" id="edit-order-body">
        <!-- Form -->
        <form id="edit-order-form">
          <div class="form-row">
            <label>Cliente</label>
            <div id="edit-customer" class="small-muted"></div>
          </div>

          <div class="form-row inline" style="margin-top:8px;">
            <div>
              <label>Motorizado asignado</label>
              <select id="edit-motorizado">
                <option value="">-- POR ASIGNAR --</option>
                <!-- opciones pobladas por JS (usuarios con role == "motorizado") -->
              </select>
            </div>
          </div>

          <div class="form-row" style="margin-top:8px;">
            <label>Comentario (obligatorio si cambia motorizado)</label>
            <textarea id="edit-motorizado-comment" rows="3" placeholder="Justifique el cambio..."></textarea>
          </div>

          <hr style="margin:12px 0;" />

          <div id="edit-items-area">
            <label>Items</label>
            <div id="items-list"></div>

            <!-- Inputs removidos: ahora la adici√≥n se realiza desde la lista de productos disponibles -->
          </div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
            <div>
              <span class="small-muted">Total:</span>
              <strong id="edit-total">$0.00</strong>
            </div>
            <div style="display:flex;gap:8px;">
              <button id="saveEditBtn" class="btn-apply" type="submit">Guardar</button>
              <button id="cancelEditBtn" class="btn btn-suspender" type="button">Cancelar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="kpiModal" class="modal hidden" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="kpiModalTitle">Informaci√≥n</h2>
        <button id="kpiModalClose" class="close-btn">√ó</button>
      </div>
      <div id="kpiModalBody" class="modal-body"></div>
      <div class="modal-footer">
        <button id="kpiModalCloseBtn" class="btn-secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

  <script type="module" src="../assets/js/sidebar-loader.js"></script>
  <script type="module" src="../assets/js/orders-admin.js"></script>
  <script type="module" src="../assets/js/vendedor-kpis.js"></script>
</body>

</html>